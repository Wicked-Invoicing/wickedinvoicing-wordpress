(()=>{"use strict";const i=window.wp.blocks,e=window.wp.i18n,n=window.wp.blockEditor,t=window.wp.components,o=window.wp.data,c=window.React,l=window.ReactJSXRuntime,s=["wicked-invoicing/line-item-description","wicked-invoicing/line-item-quantity","wicked-invoicing/line-item-rate","wicked-invoicing/line-item-discount","wicked-invoicing/line-item-tax","wicked-invoicing/line-item-total"],a=[["core/columns",{isStackedOnMobile:!0},[["core/column",{width:"30%"},[["wicked-invoicing/line-item-description"]]],["core/column",{width:"10%"},[["wicked-invoicing/line-item-quantity"]]],["core/column",{width:"15%"},[["wicked-invoicing/line-item-rate"]]],["core/column",{width:"15%"},[["wicked-invoicing/line-item-discount"]]],["core/column",{width:"15%"},[["wicked-invoicing/line-item-tax"]]],["core/column",{width:"15%"},[["wicked-invoicing/line-item-total"]]]]]],r={"wicked-invoicing/line-item-description":(0,e.__)("Description","wicked-invoicing"),"wicked-invoicing/line-item-quantity":(0,e.__)("Qty","wicked-invoicing"),"wicked-invoicing/line-item-rate":(0,e.__)("Rate","wicked-invoicing"),"wicked-invoicing/line-item-discount":(0,e.__)("Discount","wicked-invoicing"),"wicked-invoicing/line-item-tax":(0,e.__)("Tax","wicked-invoicing"),"wicked-invoicing/line-item-total":(0,e.__)("Total","wicked-invoicing")},d={description:"30%",quantity:"10%",rate:"15%",discount:"15%",tax:"15%",total:"15%"},m=new Set(["quantity","rate","discount","tax","total"]);(0,i.registerBlockType)("wicked-invoicing/line-items",{edit:function({attributes:i,setAttributes:w,clientId:u}){const{headers:g=r,showPreview:k=!0,previewRows:v=2,columnWidths:p=d}=i,h=(0,n.useBlockProps)({className:"wi-line-items--editor"}),_=(0,o.useSelect)(i=>i("core/block-editor").getBlocks(u),[u]),x=(0,c.useMemo)(()=>function(i){const e=[],n=(i=[])=>{i.forEach(i=>{const t=i?.name||i?.blockName;t&&s.includes(t)&&e.push(t),i?.innerBlocks?.length&&n(i.innerBlocks)})};return n(i),e.length?e:s}(_),[_]),b=(0,c.useMemo)(()=>function(i,e={}){return i.map(i=>{const n=i.replace("wicked-invoicing/line-item-","");return`minmax(0, ${e&&e[n]||d[n]||"1fr"})`}).join(" ")}(x,p),[x,p]),y=(0,c.useCallback)((i,e)=>{const n=e.currentTarget.textContent;w({headers:{...g,[i]:n}})},[g,w]),j=(0,c.useMemo)(()=>{if(!k)return null;const i=function(i=2){const n=[];for(let t=0;t<i;t++)n.push({description:0===t?(0,e.__)("Build Website for Customer","wicked-invoicing"):(0,e.__)("Secondary Descriptions for billed items","wicked-invoicing"),quantity:0===t?199:200,rate:1,discount:0===t?1:0,tax:0,total:0===t?198:200});return n}(v);return(0,l.jsx)("div",{className:"wi-line-items__preview",children:i.map((i,e)=>(0,l.jsx)("div",{className:"wi-line-items__row","data-index":e,style:{display:"grid",gridTemplateColumns:b,columnGap:"1rem",alignItems:"start",marginBottom:".5rem"},children:x.map(n=>{const t=n.replace("wicked-invoicing/line-item-","");let o="";switch(t){case"description":o=i.description;break;case"quantity":o=i.quantity;break;case"rate":o=i.rate.toFixed(2);break;case"discount":o=i.discount.toFixed(2);break;case"tax":o=i.tax.toFixed(2);break;case"total":o=i.total.toFixed(2)}const c={minWidth:"0"},s="description"===t?{...c,whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word",hyphens:"auto"}:m.has(t)?{...c,textAlign:"right",whiteSpace:"nowrap"}:c;return(0,l.jsx)("div",{className:`wi-line-items__cell wi-line-items__cell--${t}`,style:s,children:o},`${n}-${e}`)})},e))})},[x,k,v,b]);return(0,l.jsxs)("div",{...h,children:[(0,l.jsxs)(n.InspectorControls,{children:[(0,l.jsxs)(t.PanelBody,{title:(0,e.__)("Preview","wicked-invoicing"),initialOpen:!0,children:[(0,l.jsx)(t.ToggleControl,{label:(0,e.__)("Show dummy rows in editor","wicked-invoicing"),checked:!!k,onChange:i=>w({showPreview:!!i})}),k&&(0,l.jsx)(t.RangeControl,{label:(0,e.__)("Dummy rows","wicked-invoicing"),min:1,max:6,value:v,onChange:i=>w({previewRows:i})})]}),(0,l.jsx)(t.PanelBody,{title:(0,e.__)("Column widths","wicked-invoicing"),initialOpen:!0,children:x.map(i=>{const n=i.replace("wicked-invoicing/line-item-",""),o=r[i]||n,c=((p||d)[n]||d[n]).toString().replace("%",""),s=parseInt(c,10)||0;return(0,l.jsx)(t.RangeControl,{label:`${o} (%)`,min:5,max:70,value:s,onChange:i=>w({columnWidths:{...d,...p||{},[n]:`${i}%`}}),help:(0,e.__)("Adjust width of this column","wicked-invoicing")},i)})})]}),(0,l.jsx)(n.InnerBlocks,{allowedBlocks:s,template:a,templateLock:!1}),(0,l.jsx)("div",{className:"wi-line-items__hint",children:(0,e.__)("Drag the chips above to change column order. Use “+” to re-add a column.","wicked-invoicing")}),(0,l.jsx)("div",{className:"wi-line-items__header",style:{display:"grid",gridTemplateColumns:b,columnGap:"1rem",alignItems:"start",fontWeight:600,paddingBottom:".5rem",marginTop:".75rem",marginBottom:".5rem",borderBottom:"1px solid rgba(0,0,0,.1)"},children:x.map(i=>{var e,n;const t=i.replace("wicked-invoicing/line-item-",""),o=m.has(t)?{textAlign:"right"}:void 0;return(0,l.jsx)("div",{className:"wi-line-items__header-cell",style:o,children:(0,l.jsx)("div",{className:`wi-line-items__cell wi-line-items__cell--${t}`,contentEditable:!0,suppressContentEditableWarning:!0,onInput:e=>y(i,e),spellCheck:!1,style:{outline:"none"},children:null!==(e=null!==(n=g?.[i])&&void 0!==n?n:r[i])&&void 0!==e?e:""})},i)})}),j]})},save:()=>null})})();